<!DOCTYPE html>
<html>
  <head>
    <title>MarketPlace - Plateforme de vente en ligne</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ›’</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ›’</text></svg>">
    <meta property="og:title" content="MarketPlace - Plateforme de vente en ligne" />
    <meta property="og:description" content="Achetez et vendez en toute simplicitÃ© sur notre marketplace moderne et sÃ©curisÃ©e." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=MarketPlace" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  <body>
    <!-- Navbar RESPONSIVE -->
    <nav class="navbar-lewagon sticky-top">
      <div class="container-fluid d-flex justify-content-between align-items-center">
        <%= link_to root_path, class: "navbar-brand d-flex align-items-center" do %>
          <div class="brand-icon">
            <i class="fas fa-store"></i>
          </div>
          <span class="brand-text">MarketPlace</span>
        <% end %>

        <!-- DESKTOP MENU -->
        <div class="desktop-menu d-flex align-items-center" style="gap: 12px;">
          <% if user_signed_in? %>
            <%= link_to new_product_path, class: "btn-sell" do %>
              <i class="fas fa-plus-circle"></i> Vendre
            <% end %>

            <%= link_to favorites_path, class: "nav-link position-relative" do %>
              <i class="fas fa-heart"></i> Favoris
              <% if current_user.favorites.count > 0 %>
                <span class="badge bg-danger position-absolute" style="top: -5px; right: -10px;">
                  <%= current_user.favorites.count %>
                </span>
              <% end %>
            <% end %>

            <%= link_to my_purchases_path, class: "nav-link" do %>
              <i class="fas fa-shopping-bag"></i> Achats
            <% end %>

            <%= link_to my_sales_path, class: "nav-link" do %>
              <i class="fas fa-chart-line"></i> Ventes
            <% end %>

            <%= link_to "DÃ©connexion", destroy_user_session_path, data: { turbo_method: :delete }, class: "btn btn-outline-secondary btn-sm" %>
          <% else %>
            <%= link_to new_user_registration_path, class: "btn-sell-guest" do %>
              <i class="fas fa-tag"></i> Vendre vos articles
            <% end %>

            <div class="auth-buttons-split">
              <%= link_to "Connexion", new_user_session_path, class: "auth-btn auth-btn-left" %>
              <%= link_to "Inscription", new_user_registration_path, class: "auth-btn auth-btn-right" %>
            </div>
          <% end %>
        </div>

        <!-- BURGER BUTTON (mobile only) -->
        <button class="mobile-burger" id="burgerBtn" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </nav>

    <!-- MOBILE MENU OVERLAY -->
    <div class="mobile-menu-overlay" id="mobileMenu">
      <div class="mobile-menu-content">
        <% if user_signed_in? %>
          <%= link_to new_product_path, class: "mobile-menu-item btn-sell-mobile" do %>
            <i class="fas fa-plus-circle"></i> Vendre un article
          <% end %>

          <%= link_to favorites_path, class: "mobile-menu-item" do %>
            <i class="fas fa-heart"></i> Favoris
            <% if current_user.favorites.count > 0 %>
              <span class="badge bg-danger"><%= current_user.favorites.count %></span>
            <% end %>
          <% end %>

          <%= link_to my_purchases_path, class: "mobile-menu-item" do %>
            <i class="fas fa-shopping-bag"></i> Mes achats
          <% end %>

          <%= link_to my_sales_path, class: "mobile-menu-item" do %>
            <i class="fas fa-chart-line"></i> Mes ventes
          <% end %>

          <%= link_to "DÃ©connexion", destroy_user_session_path, data: { turbo_method: :delete }, class: "mobile-menu-item btn-logout" do %>
            <i class="fas fa-sign-out-alt"></i> DÃ©connexion
          <% end %>
        <% else %>
          <%= link_to new_user_registration_path, class: "mobile-menu-item btn-sell-mobile" do %>
            <i class="fas fa-tag"></i> Vendre vos articles
          <% end %>

          <%= link_to new_user_session_path, class: "mobile-menu-item" do %>
            <i class="fas fa-sign-in-alt"></i> Connexion
          <% end %>

          <%= link_to new_user_registration_path, class: "mobile-menu-item btn-register" do %>
            <i class="fas fa-user-plus"></i> Inscription
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Messages flash -->
    <% if notice %>
      <div class="alert alert-success alert-flash">
        <i class="fas fa-check-circle"></i> <%= notice %>
      </div>
    <% end %>
    <% if alert %>
      <div class="alert alert-danger alert-flash">
        <i class="fas fa-exclamation-triangle"></i> <%= alert %>
      </div>
    <% end %>

    <!-- Contenu principal -->
    <main>
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="footer-normal">
      <div class="footer-content">
        <div class="footer-grid">
          <div class="footer-section footer-about">
            <div class="brand-logo">
              <i class="fas fa-store"></i>
              <span>MarketPlace</span>
            </div>
            <p>La marketplace de confiance pour acheter et vendre en toute sÃ©curitÃ©.</p>
            <div class="stats-mini">
              <div class="stat">
                <span class="number"><%= Product.count %></span>
                <span class="label">Produits</span>
              </div>
              <div class="stat">
                <span class="number"><%= User.count %></span>
                <span class="label">Membres</span>
              </div>
            </div>
          </div>

          <div class="footer-section">
            <h4>Navigation</h4>
            <ul>
              <li><%= link_to root_path do %><i class="fas fa-home"></i>Accueil<% end %></li>
              <li><%= link_to products_path do %><i class="fas fa-shopping-bag"></i>Produits<% end %></li>
            </ul>
          </div>

          <div class="footer-section footer-social">
            <h4>Nous suivre</h4>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
          </div>
        </div>

        <div class="footer-bottom">
          <div class="footer-bottom-content">
            <div class="copyright">&copy; 2024 MarketPlace - Tous droits rÃ©servÃ©s</div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
      // Auto-hide flash messages
      setTimeout(() => {
        document.querySelectorAll('.alert-flash').forEach(el => {
          el.style.opacity = '0';
          setTimeout(() => el.remove(), 300);
        });
      }, 4000);

      // Mobile menu toggle
      const burgerBtn = document.getElementById('burgerBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      
      burgerBtn.addEventListener('click', () => {
        burgerBtn.classList.toggle('active');
        mobileMenu.classList.toggle('active');
        document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
      });

      // Close menu when clicking on overlay
      mobileMenu.addEventListener('click', (e) => {
        if (e.target === mobileMenu) {
          burgerBtn.classList.remove('active');
          mobileMenu.classList.remove('active');
          document.body.style.overflow = '';
        }
      });

      // Close menu when clicking on a link
      document.querySelectorAll('.mobile-menu-item').forEach(item => {
        item.addEventListener('click', () => {
          burgerBtn.classList.remove('active');
          mobileMenu.classList.remove('active');
          document.body.style.overflow = '';
        });
      });
    </script>
  </body>
</html>
