<!DOCTYPE html>
<html>
  <head>
    <title>MarketPlace - Plateforme de vente en ligne</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ›’</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ›’</text></svg>">
    <meta property="og:title" content="MarketPlace - Plateforme de vente en ligne" />
    <meta property="og:description" content="Achetez et vendez en toute simplicitÃ© sur notre marketplace moderne et sÃ©curisÃ©e." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=MarketPlace" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Font Awesome LOCAL -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <%= javascript_importmap_tags %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <style>
      /* Bootstrap minimal inline pour Ã©viter les CDN */
      .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
      .row { display: flex; flex-wrap: wrap; margin: 0 -15px; }
      .col, .col-md-3, .col-md-4, .col-md-6, .col-md-8, .col-md-12 { padding: 0 15px; }
      .col-md-3 { flex: 0 0 25%; max-width: 25%; }
      .col-md-4 { flex: 0 0 33.333%; max-width: 33.333%; }
      .col-md-6 { flex: 0 0 50%; max-width: 50%; }
      .col-md-8 { flex: 0 0 66.666%; max-width: 66.666%; }
      .col-md-12 { flex: 0 0 100%; max-width: 100%; }
      .d-flex { display: flex; }
      .justify-content-between { justify-content: space-between; }
      .justify-content-center { justify-content: center; }
      .align-items-center { align-items: center; }
      .mb-2 { margin-bottom: 0.5rem; }
      .mb-3 { margin-bottom: 1rem; }
      .mb-4 { margin-bottom: 1.5rem; }
      .mb-5 { margin-bottom: 3rem; }
      .mt-3 { margin-top: 1rem; }
      .mt-4 { margin-top: 1.5rem; }
      .mt-5 { margin-top: 3rem; }
      .my-5 { margin-top: 3rem; margin-bottom: 3rem; }
      .me-2 { margin-right: 0.5rem; }
      .me-3 { margin-right: 1rem; }
      .ms-2 { margin-left: 0.5rem; }
      .text-center { text-align: center; }
      .text-muted { color: #6c757d; }
      .text-primary { color: #6366F1; }
      .text-success { color: #10B981; }
      .text-danger { color: #EF4444; }
      .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
      .form-control, .form-select { display: block; width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid #E5E7EB; border-radius: 8px; }
      .form-control:focus, .form-select:focus { outline: none; border-color: #6366F1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
      .btn { padding: 0.75rem 1.5rem; border-radius: 999px; font-weight: 600; border: none; cursor: pointer; display: inline-block; text-decoration: none; }
      .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }
      .btn-outline-primary { border: 2px solid #6366F1; color: #6366F1; background: transparent; }
      .btn-outline-primary:hover { background: #6366F1; color: white; }
      .btn-outline-secondary { border: 2px solid #9CA3AF; color: #4B5563; background: transparent; }
      .btn-outline-danger { border: 2px solid #EF4444; color: #EF4444; background: transparent; }
      .btn-secondary { background: #9CA3AF; color: white; }
      .btn-success { background: #10B981; color: white; }
      .w-100 { width: 100%; }
      .card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 1rem; }
      .card-body { padding: 1.5rem; }
      .card-header { padding: 1rem 1.5rem; border-bottom: 1px solid #E5E7EB; font-weight: 600; }
      .badge { padding: 0.35em 0.65em; font-size: 0.75em; font-weight: 700; border-radius: 999px; }
      .bg-primary { background: #6366F1 !important; color: white; }
      .bg-success { background: #10B981 !important; color: white; }
      .bg-danger { background: #EF4444 !important; color: white; }
      .bg-warning { background: #F59E0B !important; color: white; }
      .bg-info { background: #3B82F6 !important; color: white; }
      .bg-secondary { background: #9CA3AF !important; color: white; }
      .alert { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
      .alert-success { background: #D1FAE5; color: #065F46; border: 1px solid #6EE7B7; }
      .alert-danger { background: #FEE2E2; color: #991B1B; border: 1px solid #FCA5A5; }
      .table { width: 100%; border-collapse: collapse; }
      .table th, .table td { padding: 0.75rem; border-bottom: 1px solid #E5E7EB; }
      .table-hover tbody tr:hover { background: #F9FAFB; }
      .position-relative { position: relative; }
      .position-absolute { position: absolute; }
      .dropdown-menu { position: absolute; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); padding: 0.5rem; min-width: 200px; z-index: 1000; }
      .dropdown-item { padding: 0.75rem 1rem; border-radius: 8px; color: #1F2937; text-decoration: none; display: block; }
      .dropdown-item:hover { background: #F3F4F6; }
      .dropdown-divider { height: 1px; background: #E5E7EB; margin: 0.5rem 0; }

      @media (max-width: 768px) {
        .col-md-3, .col-md-4, .col-md-6, .col-md-8 { flex: 0 0 100%; max-width: 100%; }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar-lewagon sticky-top">
      <div class="container-fluid">
        <%= link_to root_path, class: "navbar-brand d-flex align-items-center" do %>
          <div class="brand-icon">
            <i class="fas fa-store"></i>
          </div>
          <span class="brand-text">MarketPlace</span>
        <% end %>

        <div class="d-flex align-items-center" style="gap: 1rem;">
          <% if user_signed_in? %>
            <%= link_to new_product_path, class: "btn-sell" do %>
              <i class="fas fa-plus-circle"></i> Vendre
            <% end %>

            <%= link_to favorites_path, class: "nav-link position-relative" do %>
              <i class="fas fa-heart"></i> Favoris
              <% if current_user.favorites.count > 0 %>
                <span class="badge bg-danger position-absolute" style="top: -5px; right: -10px;">
                  <%= current_user.favorites.count %>
                </span>
              <% end %>
            <% end %>

            <%= link_to my_purchases_path, class: "nav-link" do %>
              <i class="fas fa-shopping-bag"></i> Achats
            <% end %>

            <%= link_to my_sales_path, class: "nav-link" do %>
              <i class="fas fa-chart-line"></i> Ventes
            <% end %>

            <%= link_to "DÃ©connexion", destroy_user_session_path, method: :delete, data: { turbo_method: :delete }, class: "btn btn-outline-secondary btn-sm" %>
          <% else %>
            <%= link_to "Connexion", new_user_session_path, class: "btn btn-outline-primary" %>
            <%= link_to "Inscription", new_user_registration_path, class: "btn-flat" %>
          <% end %>
        </div>
      </div>
    </nav>

    <!-- Messages flash -->
    <% if notice %>
      <div class="alert alert-success alert-flash">
        <i class="fas fa-check-circle"></i> <%= notice %>
      </div>
    <% end %>
    <% if alert %>
      <div class="alert alert-danger alert-flash">
        <i class="fas fa-exclamation-triangle"></i> <%= alert %>
      </div>
    <% end %>

    <!-- Contenu principal -->
    <main>
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="footer-normal">
      <div class="footer-content">
        <div class="footer-grid">
          <div class="footer-section footer-about">
            <div class="brand-logo">
              <i class="fas fa-store"></i>
              <span>MarketPlace</span>
            </div>
            <p>La marketplace de confiance pour acheter et vendre en toute sÃ©curitÃ©.</p>
            <div class="stats-mini">
              <div class="stat">
                <span class="number"><%= Product.count %></span>
                <span class="label">Produits</span>
              </div>
              <div class="stat">
                <span class="number"><%= User.count %></span>
                <span class="label">Membres</span>
              </div>
            </div>
          </div>

          <div class="footer-section">
            <h4>Navigation</h4>
            <ul>
              <li><%= link_to root_path do %><i class="fas fa-home"></i>Accueil<% end %></li>
              <li><%= link_to products_path do %><i class="fas fa-shopping-bag"></i>Produits<% end %></li>
            </ul>
          </div>

          <div class="footer-section footer-social">
            <h4>Nous suivre</h4>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
          </div>
        </div>

        <div class="footer-bottom">
          <div class="footer-bottom-content">
            <div class="copyright">&copy; 2024 MarketPlace - Tous droits rÃ©servÃ©s</div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // Auto-hide flash messages
      setTimeout(() => {
        document.querySelectorAll('.alert-flash').forEach(el => {
          el.style.opacity = '0';
          setTimeout(() => el.remove(), 300);
        });
      }, 4000);
    </script>
  </body>
</html>
